---
title: ".NET/C# 建议的异常处理方式"
date: 2017-12-03 08:55:43 +0800
categories: csharp dotnet wpf
published: false
---

“体验”一词早已泛滥却又能够粗略地表达开发团队对客户端产品的要求，“质量”在体验中扮演的角色是——**做得好了用户感觉不到，做得差一点儿用户就会破口大骂**。

本文将以提升客户端 GUI 产品质量为目标，谈谈 .NET/C# 中建议的异常处理方式。

---

<div id="toc"></div>

### 不恰当的异常处理会带来什么影响？

DEMO 和学习资料是无所谓的，找个地方写写 `try`-`catch`-`finally` 就完了……但是一旦这一行为迁移到了大型产品或软件系统中，不恰当的异常处理将会带来严重的体验下降或者巨大的额外维护成本。

#### 严重的体验下降

众所周知，如果应用中存在大量未经处理的异常，那么应用分分钟崩溃死掉。如果软件面向最终用户，那么用户将不停地遭遇闪退或者“停止工作”。如果面向服务器或其他系统，频繁挂掉也几乎意味着服务不可用。

这是异常处理“不足”造成的影响。

不过，处理“不足”这种情况大家见得少，因为实际开发中更多遇到的不是很多异常未经处理，而是各种异常都处理掉了。算是“过度”吧。

#### 巨大的额外维护成本

如果我们在各个功能上都加上 `try`-`catch` 块，在 `catch` 里吞掉异常，软件确实是不会崩了，但部分功能代码也不会执行执行了。本来用户那里崩溃一下还能逼着开发者去调查一下原因，现在连崩溃都看不到，甚至都不知道软件已经濒临挂掉的边缘。积少成多的这些小错误会瞬间积累，形成一组复杂的不可描述和预知的现象。没有人能说明这现象背后到底是哪个模块的错误导致的。于是，分析一个用户反馈的错误将变得非常低效，每一次错误都难以说出具体出错的模块到底是哪个——软件的质量只有日益下降，维护成本持续升高了。

不要说在每个 `catch` 块里记了 log，log 是开发者们从来不会主动去看的文件，从来都是出了问题才看的，而且看了也只能修复 BUG，解决不了问题！

我举个例子：软件为用户储存一份文档，在此过程中发生了异常却被吞掉了（就算记了 log）；那么用户极有可能得到一份缺失重要内容的损坏的文档——看 log 能帮用户找回损失吗？！

### 总揽全局——分层的异常处理



### 定出原则——职责分明

### 细致入微——建议的异常代码
