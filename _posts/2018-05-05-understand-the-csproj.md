---
title: "理解 C# 项目 csproj 文件格式的本质"
date: 2018-05-05 14:04:06 +0800
categories: visualstudio
published: false
---

写了这么多个 C# 项目，是否对项目文件 csproj 有一些了解呢？Visual Studio 是怎么让 csproj 中的内容正确显示出来的呢？更深入的，我能够自己扩展 csproj 的功能吗？

本文将直接从 csproj 文件格式的本质来看以上这些问题。

---

阅读本文，你将：

- 可以通读 csproj 文件，并说出其中每一行的含义
- 可以手工修改 csproj 文件，以实现你希望达到的高级功能（更高级的，可以开始写个工具自动完成这样的工作了）
- 理解新旧 csproj 文件的差异，不至于写工具解析和修改 csproj 文件的时候出现不兼容的错误

<div id="toc"></div>

### csproj 里面是什么？

相信你一定见过传统的 csproj 文件格式。就算你几乎从来没主动去看过里面的内容，在版本管理工具中解冲突时也在里面修改过内容。

不管你是新手还是老手，一定都会觉得这么长这么复杂的文件一定不是给人类阅读的。你说的是对的！传统 csproj 文件中有大量的重复或者相似内容，只为 msbuild 和 Visual Studio 能够识别整个项目的属性和结构，以便正确编译项目。

不过，既然这篇文字的目标便是理解 csproj 文件格式的本质，那我当然不会把这么复杂的文字直接给你去阅读。

我已经将整个文件结构进行了极度简化，然后用思维导图进行了分割。总结成了下图，如果先不关注文件的细节，是不是更容易看懂了呢？

![传统的 csproj 文件格式](/static/posts/2018-05-05-12-31-53.png)
